



# 整数集合

* 整数集合【intset】是集合键【Set】的底层实现之一
* 当一个集合**只包含整数值**元素，且数量不多时，会使用整数集合作为集合键的底层实现

* 保存int16_t、int32_t、int64_t的整数值，且保证集合内不会有重复元素。

## 数据结构

```c
typedef struct intset {
    uint32_t encoding; // 编码方式 指明位数
    uint32_t length; // 集合元素数量
    int8_t contents[]; // 内容,数组内容真正类型取决于encoding属性，并不是int8_t。按照从小到排序，没有重复
} intset;

```



## 升级

* 当我们要将一个新元素添加到整数集合里，并且**新元素的类型比整数集合现有所有的元素类型都要长**时，整数集合要**先进行升级才能添加新数据**

- 整数升级步骤包括三步：
  - 根据新元素类型长度和元素加入后集合的长度，扩展底层数组空间大小。
  - 将底层数组数据都转换成新的类型，并放到正确位置
  - 新元素添加到底层数组里面
  - 修改整数集合 encoding 属性的值为对应的类型
- 添加元素可能导致升级，所以添加新元素的时间复杂度为O(N)
- 不支持降级，升级后将一直保持新的数据类型



### 升级的好处

- 提高灵活性，不必担心出现类型错误
- 升级操作只会在有需要的时候进行，节约内存



## 应用场景

* 需要存储大量整数且排序时
